{# Shared task control styles - minimal now that we use simple dropdowns #}
<style>
    .task-control {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }
</style>

{# Shared task control JavaScript #}
<script>
async function createTableTask(candidateId, taskIdentifier) {
    try {
        const response = await fetch(`/api/candidate/${candidateId}/task/${taskIdentifier}/update`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ status: 'not_started' })
        });

        const data = await response.json();

        if (response.ok && data.success) {
            // Reload page to show the new task with dropdown
            location.reload();
        } else {
            alert('Error: ' + (data.error || 'Failed to create task'));
        }
    } catch (error) {
        alert('Error: ' + error.message);
    }
}

async function updateTableTaskStatus(candidateId, taskIdentifier, select) {
    const newStatus = select.value;
    const originalValue = select.dataset.originalValue || select.value;

    // Disable select during request
    select.disabled = true;

    try {
        const response = await fetch(`/api/candidate/${candidateId}/task/${taskIdentifier}/update`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ status: newStatus })
        });

        const data = await response.json();

        if (response.ok && data.success) {
            // Reload page to show updated state
            location.reload();
        } else {
            alert('Error: ' + (data.error || 'Failed to update task'));
            select.value = originalValue;
            select.disabled = false;
        }
    } catch (error) {
        alert('Error: ' + error.message);
        select.value = originalValue;
        select.disabled = false;
    }
}

// Store original values on page load
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.table-status-select').forEach(select => {
        select.dataset.originalValue = select.value;
    });
});
</script>
