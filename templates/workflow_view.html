{% extends "base.html" %}

{% block title %}{{ candidate.name }} - Workflow - Hiring Process Management{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/workflow.css">
{% endblock %}

{% block content %}
<div class="workflow-header">
    <h2>{{ candidate.name or 'Candidate' }} - Workflow Progress</h2>
    <div>
        <a href="/candidate/{{ candidate.email|urlencode }}" class="btn btn-secondary">View Details</a>
        <a href="/" class="btn btn-secondary">Back to List</a>
    </div>
</div>

<div class="workflow-info">
    <strong>Workflow:</strong> {{ workflow.name }} ({{ workflow.id }})<br>
    <strong>Description:</strong> {{ workflow.description or 'No description' }}
</div>

<div class="dag-container" id="dag-container">
    <svg class="dag-svg" id="dag-svg"></svg>
    <div class="task-grid" id="task-grid">
        {% for task_info in tasks %}
        <div class="task-card {{ task_info.state }}"
             data-task-id="{{ task_info.definition.identifier }}"
             data-layer="{{ task_info.layout.layer }}"
             data-index="{{ task_info.layout.index }}"
             data-total="{{ task_info.layout.total_in_layer }}"
             data-deps="{{ task_info.definition.dependencies | join(',') }}">
            <div class="task-info">
                <div class="task-text">
                    <div class="task-name">{{ task_info.definition.name }}</div>
                    <div class="task-identifier">{{ task_info.definition.identifier }}</div>
                </div>
                <div class="task-control">
                    {% if task_info.candidate_task %}
                    <select class="status-select"
                            onchange="updateTaskStatus('{{ candidate.email|urlencode }}', '{{ task_info.definition.identifier }}', this)">
                        <option value="not_started" {% if task_info.state == 'not_started' %}selected{% endif %}>Not Started</option>
                        <option value="in_progress" {% if task_info.state == 'in_progress' %}selected{% endif %}>In Progress</option>
                        <option value="completed" {% if task_info.state == 'completed' %}selected{% endif %}>Completed</option>
                        <option value="na" {% if task_info.state == 'na' %}selected{% endif %}>N/A</option>
                    </select>
                    {% else %}
                    <button class="btn btn-sm" onclick="createTask('{{ candidate.email|urlencode }}', '{{ task_info.definition.identifier }}')">Create</button>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

{% endblock %}
