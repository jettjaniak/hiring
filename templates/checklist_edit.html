{% extends "base.html" %}

{% block title %}{{ 'Edit' if mode == 'edit' else 'Add' }} Checklist{% endblock %}

{% block content %}
<div class="form-container">
    <h2>{{ 'Edit' if mode == 'edit' else 'Add' }} Checklist</h2>

    <form method="post" action="{{ '/checklists/' + checklist.id + '/edit' if mode == 'edit' else '/checklists/add' }}" id="checklistForm">
        <div class="form-group">
            <label for="checklist_id">Checklist ID *</label>
            <input type="text" id="checklist_id" name="checklist_id" value="{{ checklist.id if checklist else '' }}" required {{ 'readonly' if mode == 'edit' else '' }}>
            <small style="display: block; margin-top: 5px; color: #666;">
                Unique identifier for this checklist (e.g., "reference_check_list", "onboarding_checklist")
                {% if mode == 'edit' %}(Cannot be changed){% endif %}
            </small>
        </div>

        <div class="form-group">
            <label for="name">Checklist Name *</label>
            <input type="text" id="name" name="name" value="{{ checklist.name if checklist else '' }}" required placeholder="e.g., Reference Check Checklist">
        </div>

        <div class="form-group">
            <label for="description">Description</label>
            <textarea id="description" name="description" rows="4" placeholder="Brief description of this checklist">{{ checklist.description if checklist else '' }}</textarea>
        </div>

        {% if mode == 'add' %}
        <div class="form-group">
            <label for="task_id">Link to Task *</label>
            <select id="task_id" name="task_id" required>
                <option value="">Select a task...</option>
                {% for task in available_tasks %}
                <option value="{{ task.task_id }}">{{ task.name }} ({{ task.task_id }})</option>
                {% endfor %}
            </select>
            <small style="display: block; margin-top: 5px; color: #666;">
                Select which task this checklist should be linked to (one-to-one relationship)
            </small>
            {% if not available_tasks %}
            <p style="color: #e74c3c; margin-top: 10px;">
                No available tasks without checklists. All tasks already have checklists or no tasks exist. <a href="/tasks/add">Create a new task</a>
            </p>
            {% endif %}
        </div>
        {% else %}
        <div class="form-group">
            <label>Linked Task</label>
            <div style="padding: 10px; background: #f5f5f5; border-radius: 4px;">
                {% if available_tasks and available_tasks|length > 0 %}
                    <strong>{{ available_tasks[0].name }}</strong> <code>({{ available_tasks[0].task_id }})</code>
                {% else %}
                    <span style="color: #999;">No task linked</span>
                {% endif %}
            </div>
            <small style="display: block; margin-top: 5px; color: #666;">
                Task link cannot be changed after creation
            </small>
        </div>
        {% endif %}

        <div class="form-group">
            <label for="items">Checklist Items *</label>
            <textarea id="items" name="items" rows="10" required placeholder="Enter each checklist item on a new line&#10;Item 1&#10;Item 2&#10;Item 3">{{ items_text if mode == 'edit' else '' }}</textarea>
            <small style="display: block; margin-top: 5px; color: #666;">
                Enter one checklist item per line
            </small>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn" {% if mode == 'add' and not available_tasks %}disabled{% endif %}>{{ 'Save Changes' if mode == 'edit' else 'Create Checklist' }}</button>
            <a href="/checklists" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

{% endblock %}
