{% extends "base.html" %}

{% block title %}{{ checklist.name }} - {{ candidate.name }}{% endblock %}

{% block content %}
<div class="form-container">
    <h2>{{ checklist.name }}</h2>

    <div style="margin-bottom: 20px; padding: 15px; background: #f5f5f5; border-radius: 4px;">
        <p><strong>Candidate:</strong> {{ candidate.name }} ({{ candidate.email }})</p>
        <p><strong>Task:</strong> {{ task_identifier }}</p>
        {% if checklist.description %}
        <p><strong>Description:</strong> {{ checklist.description }}</p>
        {% endif %}
    </div>

    <form id="checklistForm">
        <div style="margin-bottom: 20px;">
            {% for i in range(items|length) %}
            <div style="margin-bottom: 12px; padding: 10px; background: white; border: 1px solid #ddd; border-radius: 4px;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input
                        type="checkbox"
                        name="item_{{ i }}"
                        id="item_{{ i }}"
                        {% if items_state[i] %}checked{% endif %}
                        style="margin-right: 10px; width: 18px; height: 18px; cursor: pointer;">
                    <span style="font-size: 1.05em;">{{ items[i] }}</span>
                </label>
            </div>
            {% endfor %}
        </div>

        <div class="form-actions">
            <button type="button" class="btn" onclick="saveChecklist()">Save</button>
            <button type="button" class="btn btn-secondary" onclick="window.close()">Close</button>
        </div>
    </form>
</div>

<script>
function saveChecklist() {
    const form = document.getElementById('checklistForm');
    const checkboxes = form.querySelectorAll('input[type="checkbox"]');
    const itemsState = Array.from(checkboxes).map(cb => cb.checked);

    // Send to API
    fetch('/api/checklist/{{ checklist.id }}/save', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            candidate_id: '{{ candidate.email }}',
            task_identifier: '{{ task_identifier }}',
            items_state: itemsState
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Checklist saved successfully!');
        } else {
            alert('Error saving checklist');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error saving checklist');
    });
}
</script>

{% endblock %}
